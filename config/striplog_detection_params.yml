# --- Striplog detection configuration ---------------------------------------

# Adaptive thresholding (OpenCV) parameters
# https://docs.opencv.org/4.x/d7/d1b/group__imgproc__misc.html#ga72b913f352e4a1b1b397736707afcde3
threshold:
    block_size: 11  # Size of neighborhood for local mean (must be odd)
    c: 10           # Constant subtracted from the local mean

# Table / striplog grid (pixels at dpi.table)
table:
    dpi: 300                # DPI for locating striplog/table section candidates
    min_line_length: 40     # Minimum length for a segment in pixels to be considered a line
    min_line_dilation: 3    # Dilation in pixels to bridge small gaps in lines before line detection
    margin_vert_line: 5     # Search area around vertical line for section connections
    min_area_ratio: 0.8     # Minimum rectangularity (0–1). 1 = perfect rectangle
    min_cell_height: 5      # Minimum cell height in pixels
    min_cell_width: 60      # Allowed cell width range in pixels
    max_cell_width: 500

# Which scoring components to use when ranking/validating candidates
score:
    dpi: 144                # DPI for computing feature scores
    toggle:
        crowding: true      # Consider image crowding density as pattern
        text_overlap: true  # Penalize overlap with detected text lines
        pattern: false      # Use pattern-based heuristics (e.g., circle, line)

    # Circle detection (only if score.toggle.pattern=true)
    hough_circles:
        dp: 2             # Accumulator resolution inverse ratio (accum_res = img_res / dp)
        min_dist: 3       # Minimum center-to-center distance between circles (px)
        param1: 30        # Upper threshold for internal Canny edge detector
        param2: 25        # Accumulator threshold for center detection (higher = fewer circles)
        min_radius: 1     # Minimum circle radius (px)
        max_radius: 8     # Maximum circle radius (px)

    # Line Segment Detector (only if score.toggle.pattern=true)
    lsd:
        scale: 1          # Image scale factor prior to detection (1 = original resolution)
        sigma_scale: 0.6  # Gaussian sigma for image smoothing (relative to scale)
        quant: 2.0        # Gradient quantization; lower = more sensitive, more segments
        ang_th: 22.5      # Angle tolerance in degrees for region growing/merging
        log_eps: 0.0      # -log10(eps) for NFA; larger (or smaller eps) = stricter validation
        density_th: 0.7   # Minimum region point density for a valid segment (0–1)
        n_bins: 1024      # Histogram bins for gradient angle quantization

# Merging parameters
merge:
    confidence_seed: 0.5    # Global confidence threshold for accepting a detected striplog section
    confidence_graph: 0.3   # Minimal confidence for section to be connected to seed
    min_sections: 2         # Minimal number of detected sections required to form a valid strip log
    r_tol_width: 0.1        # Maximum allowed relative difference in width between two sections
    a_tol_height: 5         # Maximum allowed vertical gap in pixels
